<% if @projects.present? %>
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white border border-collapse border-gray-300">
      <thead class="bg-purple-900 text-white">
        <tr>
          <th class="border-b p-2">ID</th>
          <th class="border-b p-2">Name</th>
          <th class="border-b p-2">Description</th>
          <% if current_user.manager? %>
            <th class="border-b p-2">Add/Remove</th>
            <th class="border-b p-2">Edit/Delete</th>
            <th class="border-b p-2">View</th>
          <% end %>
          <% if current_user.qa? %>
            <th class="border-b p-2">Actions</th>
            <th class="border-b p-2">Bug count</th>
            <th class="border-b p-2">Feature count</th>
            <th class="border-b p-2">View</th>
          <% end %>
          <% if current_user.developer? %>
            <th class="border-b p-2">Actions</th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% @projects.each do |project| %>
          <tr class="<%= cycle('bg-gray-50', 'bg-gray-100') %>">
            <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>"><%= project.id %></td>
            <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>"><%= project.name %></td>
            <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
              <%= truncate(project.description, length: 30, separator: ' ', omission: '...') %>
            </td>
            <% if current_user.manager? %>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= link_to "Add/Remove", new_user_project_path(project_id: project.id), class: 'btn btn-add btn-sm inline-block', data: { turbo_frame: 'project' } %>
                <% end %>
              </td>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <div class="flex space-x-2">
                    <%= link_to 'Edit', edit_project_path(project), class: 'btn btn-edit btn-sm inline-block', data: { turbo_frame: 'project' }  %>
                    <%= button_to "Delete", project_path(project), method: :delete, class: "btn btn-danger btn-sm inline-block", data: { "turbo-method": :delete, turbo_confirm: "Are you sure?" } %>
                  </div>
                <% end %>
              </td>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= link_to "View Project", project_path(project.id), class: 'btn btn-view btn-sm inline-block', data: { turbo_frame: 'project' } %>
                <% end %>
              </td>
            <% end %>
            <% if current_user.qa? %>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= link_to "Report a bug/feature", new_project_bug_path(project.id), class: 'btn btn-primary btn-sm inline-block', data: { turbo_frame: 'project' } %>
                <% end %>
              </td>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= project.bugs.where(bug_type: 'Bug').count %>
                <% end %>
              </td>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= project.bugs.where(bug_type: 'Feature').count %>
                <% end %>
              </td>
            <% end %>
            <% if current_user.qa? || current_user.developer? %>
              <td class="border-b p-2 <%= highlight_background?(current_user, project) ? 'bg-green-200' : '' %>">
                <%= turbo_frame_tag "project" do %>
                  <%= link_to "View Bug/Feature", project_bugs_path(project.id), class: 'btn btn-primary btn-sm inline-block', data: { turbo_frame: 'project' } %>
                </td>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% else %>
  <h1 class="text-white text-center">No Projects Assigned Yet</h1>
<% end %>
